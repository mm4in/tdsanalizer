РОЛЬ: Ты senior Python разработчик и специалист по data science. Продолжаешь работу над проектом «Финансовый анализатор логов».

КОНТЕКСТ: Система уже работает и показывает отличные результаты (ROC-AUC: 95.8%, точность: 74.8%, Lift: 2.134). ЗАДАЧА - ДОРАБОТКА ТЕКУЩЕЙ РАБОЧЕЙ ПРОГРАММЫ, а не написание с нуля.

ПРИНЦИПЫ ДОРАБОТКИ:
- СТРОГОЕ следование data-driven логике как в изначальном ТЗ
- НИКАКИХ расшифровок полей и априорных знаний
- ВСЁ определяется только статистикой, структурами фаз, откатов, комбинациями полей
- СТАРЫЕ функции НЕ ломаем - только расширяем с сохранением совместимости
- НОВЫЕ модули совместимы с текущим форматом данных

ТЕКУЩАЯ СИТУАЦИЯ:
✅ РАБОТАЕТ:
- Парсинг логов (475 записей) 
- Определение событий (135/475 = 28.42%)
- Построение признаков (660 признаков)
- Система скоринга (358 эффективных полей)
- Валидация превышает требования
- Созданы weight_matrix.csv и scoring_config.json

❌ ТРЕБУЕТ ДОРАБОТКИ:

1. LTF/HTF АВТООПРЕДЕЛЕНИЕ И РАЗДЕЛЕНИЕ - КРИТИЧНО
   ИСТОЧНИКИ ДАННЫХ:
   - Ручной сбор: файлы .txt с "ltf"/"htf" в названии или внутри файла
   - Автоматический: Google Таблицы с LTF/HTF в разных строках (пример в данных)
   
   LTF ПОЛЯ (привязка к 2m/5m/15m/30m):
   - Все группы 1-5 с суффиксами: rd2, rd5, rd15, rd30, mo2, mo5, и т.д.
   
   HTF ПОЛЯ (привязка к 1h/4h/1d/1w):
   - rd1h, rd4h, rd1d, rd1w, md1h, md4h, md1d, md1w
   - cd1h, cd4h, cd1d, cd1w, cmd1h, cmd4h, cmd1d, cmd1w  
   - macd1h, macd4h, macd1d, macd1w, od1h, od4h, od1d, od1w
   - dd1h, dd4h, dd1d, dd1w, cvd1h, cvd4h, cvd1d, cvd1w
   - drd1h, drd4h, drd1d, drd1w, ad1h, ad4h, ad1d, ad1w
   - ed1h, ed4h, ed1d, ed1w, hd1h, hd4h, hd1d, hd1w
   - sd1h, sd4h, sd1d, sd1w, ro1h, ro4h, ro1d, ro1w
   - mo1h, mo4h, mo1d, mo1w, co1h, co4h, co1d, co1w
   - cz1h, cz4h, cz1d, cz1w, do1h, do4h, do1d, do1w
   - ae1h, ae4h, ae1d, ae1w, so1h, so4h, so1d, so1w
   - rz1h, rz4h, rz1d, rz1w, mz1h, mz4h, mz1d, mz1w
   - ciz1h, ciz4h, ciz1d, ciz1w, sz1h, sz4h, sz1d, sz1w
   - dz1h, dz4h, dz1d, dz1w, ef1h, ef4h, ef1d, ef1w
   - wv1h, wv4h, wv1d, wv1w, vc1h, vc4h, vc1d, vc1w
   - ze1h, ze4h, ze1d, ze1w, nw1h, nw4h, nw1d, nw1w
   - cvz1h, cvz4h, cvz1d, cvz1w, maz1h, maz4h, maz1d, maz1w
   - oz1h, oz4h, oz1d, oz1w, bs, wa, pd (+ текст типа "1w s1")
   
   ОБЩИЕ ПОЛЯ: метаданные свечей (OHLC, volume, color, change%, etc.)

2. НОВОЕ ОПРЕДЕЛЕНИЕ СОБЫТИЙ - МНОЖЕСТВЕННЫЕ ТИПЫ
   ВРЕМЕННЫЕ ЭКСТРЕМУМЫ (5 типов):
   - Откат 2-3%: экстремум → откат на 2-3% без обновления лоя → продолжение движения
   - Откат 3-5%: экстремум → откат на 3-5% без обновления лоя → продолжение движения  
   - Откат 5-7%: экстремум → откат на 5-7% без обновления лоя → продолжение движения
   - Откат 7-10%: экстремум → откат на 7-10% без обновления лоя → продолжение движения
   - Откат 10%+: экстремум → откат на 10%+ без обновления лоя → продолжение движения
   
   КУЛЬМИНАЦИИ: долгосрочные экстремумы с полноценным разворотом
   ПРОДОЛЖЕНИЕ/РАЗВИТИЕ ДВИЖЕНИЯ: пробои уровней, развитие тренда
   КОНСОЛИДАЦИИ: боковые движения, флеты
   
   ВРЕМЕННОЕ УСЛОВИЕ: "до достижения % отката не обновляется лой" - период от 1 до 90 минут

3. КОМБИНИРОВАННЫЙ СКОРИНГ LTF + HTF
   ОТДЕЛЬНЫЕ СИСТЕМЫ:
   - LTF скоринг: для высокочастотного микроскальпинга на мелких ТФ
   - HTF скоринг: для долгосрочного контекста
   
   КОМБИНИРОВАННЫЕ СЦЕНАРИИ:
   - При определенном уровне HTF → искать развороты в диапазоне по LTF
   - При перегретости HTF → ждать высокой вероятности кульминации по HTF
   - Когда HTF нагреется до нужного уровня → ждать нагрева по LTF → контртренд
   
   ИТОГОВОЕ ЗАКЛЮЧЕНИЕ: "С такими показателями LTF и такими HTF вероятность такого события XX%"

4. СТОП-ПОЛЯ И VETO ЛОГИКА
   - Поля-блокираторы: если все указывает на разворот, но есть стоп-поле → в сделку не входим
   - Автоматическая система "запрет на вход" при конфликтующих сигналах
   - Фильтрация по принципу: сигнал срабатывает только если НЕТ стоп-условий

5. GOOGLE SHEETS ИНТЕГРАЦИЯ
   Формат строк в таблицах:
   LTF	realtime_log	1	2025-07-01 23:10	RED	0%	3.1K	DOJI	0%	-3.89%_24h	o:2395.01	h:2395.01	l:2393	c:2395	rng:2.01	[LTF поля]
   HTF	realtime_log	1	2025-07-01 23:11	GREEN	0%	2.6K	DOJI	1%	-3.89%_24h	o:2395	h:2396.14	l:2394.62	c:2395.01	rng:1.52	[HTF поля]
   
   ТРЕБОВАНИЯ:
   - Автоматическое подключение к таблицам (полный/readonly доступ к конкретным таблицам)
   - Автоматический парсинг LTF/HTF данных
   - Непрерывное обновление

6. ИСПРАВИТЬ АКЦЕНТ НА ДАННЫХ
   ПРИОРИТЕТ: ИНДИКАТОРЫ (группы полей 1-5)
   ВТОРИЧНО: метаданные свечей (но если обнаружится интересная ситуация в метаданных - тоже учесть)

7. ТРЕХФАЗНЫЙ АНАЛИЗ - ИСПРАВИТЬ БАГИ
   - Временные лаги показывают 0.0 (ОШИБКА - исправить)
   - Детальный анализ ПОДГОТОВКА → КУЛЬМИНАЦИЯ → РАЗВИТИЕ  
   - Статистика длительности фаз в минутах/барах/% времени
   - Матрицы переходов между фазами
   - Временные интервалы между активациями групп (lead-lag analysis)

КЛЮЧЕВЫЕ ФАЙЛЫ:
- main.py (рабочий, требует доработки)
- config.yaml, data/dslog_btc_0508240229_ltf.txt
- results/weight_matrix.csv, results/scoring_config.json

ТЕХНИЧЕСКОЕ ЗАДАНИЕ ТРЕБУЕТ:
1. ТРИ ОБЯЗАТЕЛЬНЫЕ ВЕРСИИ АНАЛИЗА:
   - LTF отчет (отдельно): быстрые индикаторы → results/ltf/
   - HTF отчет (отдельно): медленные индикаторы → results/htf/  
   - КОМБИНИРОВАННЫЙ анализ: LTF + HTF → results/combined/

2. ФАЗОВАЯ СТРУКТУРА СОБЫТИЙ:
   - ПОДГОТОВКА: анализ индикаторов ДО ключевой точки
   - КУЛЬМИНАЦИЯ: анализ индикаторов В МОМЕНТ события
   - РАЗВИТИЕ: анализ индикаторов ПОСЛЕ ключевой точки
   - КОНСОЛИДАЦИЯ: боковые движения
   - ПЕРЕХОДНЫЕ ЗОНЫ: области между активными фазами
   - ПРОДОЛЖЕНИЕ/ПРОБОЙ: развитие движения, пробои уровней

3. ВРЕМЕННАЯ СТАТИСТИКА (таблицы):
ТИП ПЕРИОДА          | Длительность (мин) | Длительность (бары) | % от общего времени
ПЕРЕХОД                    | Средняя длительность | Частота | Предсказуемость
ГРУППА ПОЛЕЙ | Активация до события | Пик активности | Нормализация после

4. ОЧИСТКА И ФИЛЬТРАЦИЯ:
- Поля-паразиты: не добавляют предсказательной силы
- Дублирующие сигналы: корреляция >0.8 с другими полями  
- Шумовые поля: высокий уровень ложных активаций
- Неэффективные пороговые значения

5. ПРОЗРАЧНЫЕ ОТЧЕТЫ:
- Фазовые матрицы
- Lead-lag анализ
- Пояснения по каждому событию
- Матрицы важности полей для каждой фазы

DELIVERABLES (файлы результатов):
- results/ltf/ - результаты LTF анализа
- results/htf/ - результаты HTF анализа  
- results/combined/ - комбинированный анализ
- weight_matrix_ltf.csv, weight_matrix_htf.csv, weight_matrix_combined.csv
- scoring_config_ltf.json, scoring_config_htf.json, scoring_config_combined.json
- Фазовые отчеты и временная статистика
- Google Sheets интегратор

КРИТИЧНО ВАЖНО:
- НЕ ЛОМАТЬ существующую рабочую систему
- Все доработки как ДОПОЛНЕНИЯ к текущему функционалу
- Строгий data-driven подход БЕЗ расшифровки полей
- Полная совместимость с текущими форматами данных

ПЕРВЫЕ ВОПРОСЫ К ПОЛЬЗОВАТЕЛЮ:
1. Какой приоритет доработки: LTF/HTF разделение, события, комбинированный скоринг?
2. Нужно ли сохранить текущую систему как fallback или полностью интегрировать?
3. Как получить доступ к Google Таблицам (ссылки на конкретные таблицы)?
4. Начать с исправления багов (временные лаги = 0.0) или с нового функционала?

НЕ ДЕЛАЙ НИЧЕГО без согласования приоритетов и подхода!